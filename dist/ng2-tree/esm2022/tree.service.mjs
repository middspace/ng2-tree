import {
  LoadNextLevelEvent,
  MenuItemSelectedEvent,
  NodeCheckedEvent,
  NodeCollapsedEvent,
  NodeCreatedEvent,
  NodeExpandedEvent,
  NodeIndeterminedEvent,
  NodeMovedEvent,
  NodeRemovedEvent,
  NodeRenamedEvent,
  NodeSelectedEvent,
  NodeUncheckedEvent,
  NodeUnselectedEvent
} from './tree.events';
import { Inject, Injectable } from '@angular/core';
import { NodeDraggableService } from './draggable/node-draggable.service';
import { isEmpty } from './utils/fn.utils';
import { Subject } from 'rxjs';
import { filter } from 'rxjs/operators';
import * as i0 from '@angular/core';
import * as i1 from './draggable/node-draggable.service';
export class TreeService {
  nodeDraggableService;
  nodeMoved$ = new Subject();
  nodeRemoved$ = new Subject();
  nodeRenamed$ = new Subject();
  nodeCreated$ = new Subject();
  nodeSelected$ = new Subject();
  nodeUnselected$ = new Subject();
  nodeExpanded$ = new Subject();
  nodeCollapsed$ = new Subject();
  menuItemSelected$ = new Subject();
  loadNextLevel$ = new Subject();
  nodeChecked$ = new Subject();
  nodeUnchecked$ = new Subject();
  nodeIndetermined$ = new Subject();
  controllers = new Map();
  constructor(nodeDraggableService) {
    this.nodeDraggableService = nodeDraggableService;
    this.nodeRemoved$.subscribe(e => e.node.removeItselfFromParent());
  }
  unselectStream(tree) {
    return this.nodeSelected$.pipe(filter(e => tree !== e.node));
  }
  fireNodeRemoved(tree) {
    this.nodeRemoved$.next(new NodeRemovedEvent(tree, tree.positionInParent));
  }
  fireNodeCreated(tree) {
    this.nodeCreated$.next(new NodeCreatedEvent(tree));
  }
  fireNodeSelected(tree) {
    this.nodeSelected$.next(new NodeSelectedEvent(tree));
  }
  fireNodeUnselected(tree) {
    this.nodeUnselected$.next(new NodeUnselectedEvent(tree));
  }
  fireNodeRenamed(oldValue, tree) {
    this.nodeRenamed$.next(new NodeRenamedEvent(tree, oldValue, tree.value));
  }
  fireNodeMoved(tree, parent) {
    this.nodeMoved$.next(new NodeMovedEvent(tree, parent));
  }
  fireMenuItemSelected(tree, selectedItem) {
    this.menuItemSelected$.next(new MenuItemSelectedEvent(tree, selectedItem));
  }
  fireNodeSwitchFoldingType(tree) {
    if (tree.isNodeExpanded()) {
      this.fireNodeExpanded(tree);
      if (this.shouldFireLoadNextLevel(tree)) {
        this.fireLoadNextLevel(tree);
      }
    } else if (tree.isNodeCollapsed()) {
      this.fireNodeCollapsed(tree);
    }
  }
  fireNodeExpanded(tree) {
    this.nodeExpanded$.next(new NodeExpandedEvent(tree));
  }
  fireNodeCollapsed(tree) {
    this.nodeCollapsed$.next(new NodeCollapsedEvent(tree));
  }
  fireLoadNextLevel(tree) {
    this.loadNextLevel$.next(new LoadNextLevelEvent(tree));
  }
  fireNodeChecked(tree) {
    this.nodeChecked$.next(new NodeCheckedEvent(tree));
  }
  fireNodeUnchecked(tree) {
    this.nodeUnchecked$.next(new NodeUncheckedEvent(tree));
  }
  draggedStream(tree, element) {
    return this.nodeDraggableService.draggableNodeEvents$.pipe(
      filter(e => e.target === element),
      filter(e => !e.captured.tree.hasChild(tree))
    );
  }
  setController(id, controller) {
    this.controllers.set(id, controller);
  }
  deleteController(id) {
    if (this.controllers.has(id)) {
      this.controllers.delete(id);
    }
  }
  getController(id) {
    if (this.controllers.has(id)) {
      return this.controllers.get(id);
    }
    return null;
  }
  hasController(id) {
    return this.controllers.has(id);
  }
  shouldFireLoadNextLevel(tree) {
    const shouldLoadNextLevel =
      tree.node.emitLoadNextLevel &&
      !tree.node.loadChildren &&
      !tree.childrenAreBeingLoaded() &&
      isEmpty(tree.children);
    if (shouldLoadNextLevel) {
      tree.loadingChildrenRequested();
    }
    return shouldLoadNextLevel;
  }
  fireNodeIndetermined(tree) {
    this.nodeIndetermined$.next(new NodeIndeterminedEvent(tree));
  }
  static ɵfac = i0.ɵɵngDeclareFactory({
    minVersion: '12.0.0',
    version: '16.2.12',
    ngImport: i0,
    type: TreeService,
    deps: [{ token: NodeDraggableService }],
    target: i0.ɵɵFactoryTarget.Injectable
  });
  static ɵprov = i0.ɵɵngDeclareInjectable({
    minVersion: '12.0.0',
    version: '16.2.12',
    ngImport: i0,
    type: TreeService
  });
}
i0.ɵɵngDeclareClassMetadata({
  minVersion: '12.0.0',
  version: '16.2.12',
  ngImport: i0,
  type: TreeService,
  decorators: [
    {
      type: Injectable
    }
  ],
  ctorParameters: function() {
    return [
      {
        type: i1.NodeDraggableService,
        decorators: [
          {
            type: Inject,
            args: [NodeDraggableService]
          }
        ]
      }
    ];
  }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3RyZWUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsa0JBQWtCLEVBQ2xCLHFCQUFxQixFQUNyQixnQkFBZ0IsRUFDaEIsa0JBQWtCLEVBQ2xCLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIscUJBQXFCLEVBQ3JCLGNBQWMsRUFDZCxnQkFBZ0IsRUFDaEIsZ0JBQWdCLEVBQ2hCLGlCQUFpQixFQUNqQixrQkFBa0IsRUFDbEIsbUJBQW1CLEVBQ3BCLE1BQU0sZUFBZSxDQUFDO0FBSXZCLE9BQU8sRUFBYyxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRTFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7O0FBR3hDLE1BQU0sT0FBTyxXQUFXO0lBaUJtQztJQWhCbEQsVUFBVSxHQUE0QixJQUFJLE9BQU8sRUFBa0IsQ0FBQztJQUNwRSxZQUFZLEdBQThCLElBQUksT0FBTyxFQUFvQixDQUFDO0lBQzFFLFlBQVksR0FBOEIsSUFBSSxPQUFPLEVBQW9CLENBQUM7SUFDMUUsWUFBWSxHQUE4QixJQUFJLE9BQU8sRUFBb0IsQ0FBQztJQUMxRSxhQUFhLEdBQStCLElBQUksT0FBTyxFQUFxQixDQUFDO0lBQzdFLGVBQWUsR0FBaUMsSUFBSSxPQUFPLEVBQXVCLENBQUM7SUFDbkYsYUFBYSxHQUErQixJQUFJLE9BQU8sRUFBcUIsQ0FBQztJQUM3RSxjQUFjLEdBQWdDLElBQUksT0FBTyxFQUFzQixDQUFDO0lBQ2hGLGlCQUFpQixHQUFtQyxJQUFJLE9B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QUNILENBQUM7SUFFTSxhQUFhLENBQUMsRUFBbUI7UUFDdEMsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUM1QixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2pDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRU0sYUFBYSxDQUFDLEVBQW1CO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVPLHVCQUF1QixDQUFDLElBQVU7UUFDeEMsTUFBTSxtQkFBbUIsR0FDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUI7WUFDM0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVk7WUFDdkIsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUU7WUFDOUIsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUV6QixJQUFJLG1CQUFtQixFQUFFO1lBQ3ZCLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1NBQ2pDO1FBRUQsT0FBTyxtQkFBbUIsQ0FBQztJQUM3QixDQUFDO0lBRU0sb0JBQW9CLENBQUMsSUFBVTtRQUNwQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUkscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDO3dHQWpJVSxXQUFXLGtCQWlCSyxvQkFBb0I7NEdBakJwQyxXQUFXOzs0RkFBWCxXQUFXO2tCQUR2QixVQUFVOzswQkFrQlcsTUFBTTsyQkFBQyxvQkFBb0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIExvYWROZXh0TGV2ZWxFdmVudCxcclxuICBNZW51SXRlbVNlbGVjdGVkRXZlbnQsXHJcbiAgTm9kZUNoZWNrZWRFdmVudCxcclxuICBOb2RlQ29sbGFwc2VkRXZlbnQsXHJcbiAgTm9kZUNyZWF0ZWRFdmVudCxcclxuICBOb2RlRXhwYW5kZWRFdmVudCxcclxuICBOb2RlSW5kZXRlcm1pbmVkRXZlbnQsXHJcbiAgTm9kZU1vdmVkRXZlbnQsXHJcbiAgTm9kZVJlbW92ZWRFdmVudCxcclxuICBOb2RlUmVuYW1lZEV2ZW50LFxyXG4gIE5vZGVTZWxlY3RlZEV2ZW50LFxyXG4gIE5vZGVVbmNoZWNrZWRFdmVudCxcclxuICBOb2RlVW5zZWxlY3RlZEV2ZW50XHJcbn0gZnJvbSAnLi90cmVlLmV2ZW50cyc7XHJcbmltcG9ydCB7IFJlbmFtYWJsZU5vZGUgfSBmcm9tICcuL3RyZWUudHlwZXMnO1xyXG5pbXBvcnQgeyBUcmVlIH0gZnJvbSAnLi90cmVlJztcclxuaW1wb3J0IHsgVHJlZUNvbnRyb2xsZXIgfSBmcm9tICcuL3RyZWUtY29udHJvbGxlcic7XHJcbmltcG9ydCB7IEVsZW1lbnRSZWYsIEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOb2RlRHJhZ2dhYmxlU2VydmljZSB9IGZyb20gJy4vZHJhZ2dhYmxlL25vZGUtZHJhZ2dhYmxlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBOb2RlRHJhZ2dhYmxlRXZlbnQgfSBmcm9tICcuL2RyYWdnYWJsZS9kcmFnZ2FibGUuZXZlbnRzJztcclxuaW1wb3J0IHsgaXNFbXB0eSB9IGZyb20gJy4vdXRpbHMvZm4udXRpbHMnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIFRyZWVTZXJ2aWNlIHtcclxuICBwdWJsaWMgbm9kZU1vdmVkJDogU3ViamVjdDxOb2RlTW92ZWRFdmVudD4gPSBuZXcgU3ViamVjdDxOb2RlTW92ZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZVJlbW92ZWQkOiBTdWJqZWN0PE5vZGVSZW1vdmVkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8Tm9kZVJlbW92ZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZVJlbmFtZWQkOiBTdWJqZWN0PE5vZGVSZW5hbWVkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8Tm9kZVJlbmFtZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZUNyZWF0ZWQkOiBTdWJqZWN0PE5vZGVDcmVhdGVkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8Tm9kZUNyZWF0ZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZVNlbGVjdGVkJDogU3ViamVjdDxOb2RlU2VsZWN0ZWRFdmVudD4gPSBuZXcgU3ViamVjdDxOb2RlU2VsZWN0ZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZVVuc2VsZWN0ZWQkOiBTdWJqZWN0PE5vZGVVbnNlbGVjdGVkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8Tm9kZVVuc2VsZWN0ZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZUV4cGFuZGVkJDogU3ViamVjdDxOb2RlRXhwYW5kZWRFdmVudD4gPSBuZXcgU3ViamVjdDxOb2RlRXhwYW5kZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZUNvbGxhcHNlZCQ6IFN1YmplY3Q8Tm9kZUNvbGxhcHNlZEV2ZW50PiA9IG5ldyBTdWJqZWN0PE5vZGVDb2xsYXBzZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbWVudUl0ZW1TZWxlY3RlZCQ6IFN1YmplY3Q8TWVudUl0ZW1TZWxlY3RlZEV2ZW50PiA9IG5ldyBTdWJqZWN0PE1lbnVJdGVtU2VsZWN0ZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbG9hZE5leHRMZXZlbCQ6IFN1YmplY3Q8TG9hZE5leHRMZXZlbEV2ZW50PiA9IG5ldyBTdWJqZWN0PExvYWROZXh0TGV2ZWxFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZUNoZWNrZWQkOiBTdWJqZWN0PE5vZGVDaGVja2VkRXZlbnQ+ID0gbmV3IFN1YmplY3Q8Tm9kZUNoZWNrZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZVVuY2hlY2tlZCQ6IFN1YmplY3Q8Tm9kZVVuY2hlY2tlZEV2ZW50PiA9IG5ldyBTdWJqZWN0PE5vZGVVbmNoZWNrZWRFdmVudD4oKTtcclxuICBwdWJsaWMgbm9kZUluZGV0ZXJtaW5lZCQ6IFN1YmplY3Q8Tm9kZUluZGV0ZXJtaW5lZEV2ZW50PiA9IG5ldyBTdWJqZWN0PE5vZGVJbmRldGVybWluZWRFdmVudD4oKTtcclxuXHJcbiAgcHJpdmF0ZSBjb250cm9sbGVyczogTWFwPHN0cmluZyB8IG51bWJlciwgVHJlZUNvbnRyb2xsZXI+ID0gbmV3IE1hcCgpO1xyXG5cclxuICBwdWJsaWMgY29uc3RydWN0b3IoQEluamVjdChOb2RlRHJhZ2dhYmxlU2VydmljZSkgcHJpdmF0ZSBub2RlRHJhZ2dhYmxlU2VydmljZTogTm9kZURyYWdnYWJsZVNlcnZpY2UpIHtcclxuICAgIHRoaXMubm9kZVJlbW92ZWQkLnN1YnNjcmliZSgoZTogTm9kZVJlbW92ZWRFdmVudCkgPT4gZS5ub2RlLnJlbW92ZUl0c2VsZkZyb21QYXJlbnQoKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdW5zZWxlY3RTdHJlYW0odHJlZTogVHJlZSk6IE9ic2VydmFibGU8Tm9kZVNlbGVjdGVkRXZlbnQ+IHtcclxuICAgIHJldHVybiB0aGlzLm5vZGVTZWxlY3RlZCQucGlwZShmaWx0ZXIoKGU6IE5vZGVTZWxlY3RlZEV2ZW50KSA9PiB0cmVlICE9PSBlLm5vZGUpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaXJlTm9kZVJlbW92ZWQodHJlZTogVHJlZSk6IHZvaWQge1xyXG4gICAgdGhpcy5ub2RlUmVtb3ZlZCQubmV4dChuZXcgTm9kZVJlbW92ZWRFdmVudCh0cmVlLCB0cmVlLnBvc2l0aW9uSW5QYXJlbnQpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaXJlTm9kZUNyZWF0ZWQodHJlZTogVHJlZSk6IHZvaWQge1xyXG4gICAgdGhpcy5ub2RlQ3JlYXRlZCQubmV4dChuZXcgTm9kZUNyZWF0ZWRFdmVudCh0cmVlKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZmlyZU5vZGVTZWxlY3RlZCh0cmVlOiBUcmVlKTogdm9pZCB7XHJcbiAgICB0aGlzLm5vZGVTZWxlY3RlZCQubmV4dChuZXcgTm9kZVNlbGVjdGVkRXZlbnQodHJlZSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZpcmVOb2RlVW5zZWxlY3RlZCh0cmVlOiBUcmVlKTogdm9pZCB7XHJcbiAgICB0aGlzLm5vZGVVbnNlbGVjdGVkJC5uZXh0KG5ldyBOb2RlVW5zZWxlY3RlZEV2ZW50KHRyZWUpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaXJlTm9kZVJlbmFtZWQob2xkVmFsdWU6IFJlbmFtYWJsZU5vZGUgfCBzdHJpbmcsIHRyZWU6IFRyZWUpOiB2b2lkIHtcclxuICAgIHRoaXMubm9kZVJlbmFtZWQkLm5leHQobmV3IE5vZGVSZW5hbWVkRXZlbnQodHJlZSwgb2xkVmFsdWUsIHRyZWUudmFsdWUpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaXJlTm9kZU1vdmVkKHRyZWU6IFRyZWUsIHBhcmVudDogVHJlZSk6IHZvaWQge1xyXG4gICAgdGhpcy5ub2RlTW92ZWQkLm5leHQobmV3IE5vZGVNb3ZlZEV2ZW50KHRyZWUsIHBhcmVudCkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZpcmVNZW51SXRlbVNlbGVjdGVkKHRyZWU6IFRyZWUsIHNlbGVjdGVkSXRlbTogc3RyaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLm1lbnVJdGVtU2VsZWN0ZWQkLm5leHQobmV3IE1lbnVJdGVtU2VsZWN0ZWRFdmVudCh0cmVlLCBzZWxlY3RlZEl0ZW0pKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaXJlTm9kZVN3aXRjaEZvbGRpbmdUeXBlKHRyZWU6IFRyZWUpOiB2b2lkIHtcclxuICAgIGlmICh0cmVlLmlzTm9kZUV4cGFuZGVkKCkpIHtcclxuICAgICAgdGhpcy5maXJlTm9kZUV4cGFuZGVkKHRyZWUpO1xyXG4gICAgICBpZiAodGhpcy5zaG91bGRGaXJlTG9hZE5leHRMZXZlbCh0cmVlKSkge1xyXG4gICAgICAgIHRoaXMuZmlyZUxvYWROZXh0TGV2ZWwodHJlZSk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAodHJlZS5pc05vZGVDb2xsYXBzZWQoKSkge1xyXG4gICAgICB0aGlzLmZpcmVOb2RlQ29sbGFwc2VkKHRyZWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaXJlTm9kZUV4cGFuZGVkKHRyZWU6IFRyZWUpOiB2b2lkIHtcclxuICAgIHRoaXMubm9kZUV4cGFuZGVkJC5uZXh0KG5ldyBOb2RlRXhwYW5kZWRFdmVudCh0cmVlKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGZpcmVOb2RlQ29sbGFwc2VkKHRyZWU6IFRyZWUpOiB2b2lkIHtcclxuICAgIHRoaXMubm9kZUNvbGxhcHNlZCQubmV4dChuZXcgTm9kZUNvbGxhcHNlZEV2ZW50KHRyZWUpKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZmlyZUxvYWROZXh0TGV2ZWwodHJlZTogVHJlZSk6IHZvaWQge1xyXG4gICAgdGhpcy5sb2FkTmV4dExldmVsJC5uZXh0KG5ldyBMb2FkTmV4dExldmVsRXZlbnQodHJlZSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZpcmVOb2RlQ2hlY2tlZCh0cmVlOiBUcmVlKTogdm9pZCB7XHJcbiAgICB0aGlzLm5vZGVDaGVja2VkJC5uZXh0KG5ldyBOb2RlQ2hlY2tlZEV2ZW50KHRyZWUpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmaXJlTm9kZVVuY2hlY2tlZCh0cmVlOiBUcmVlKTogdm9pZCB7XHJcbiAgICB0aGlzLm5vZGVVbmNoZWNrZWQkLm5leHQobmV3IE5vZGVVbmNoZWNrZWRFdmVudCh0cmVlKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZHJhZ2dlZFN0cmVhbSh0cmVlOiBUcmVlLCBlbGVtZW50OiBFbGVtZW50UmVmKTogT2JzZXJ2YWJsZTxOb2RlRHJhZ2dhYmxlRXZlbnQ+IHtcclxuICAgIHJldHVybiB0aGlzLm5vZGVEcmFnZ2FibGVTZXJ2aWNlLmRyYWdnYWJsZU5vZGVFdmVudHMkLnBpcGUoXHJcbiAgICAgIGZpbHRlcigoZTogTm9kZURyYWdnYWJsZUV2ZW50KSA9PiBlLnRhcmdldCA9PT0gZWxlbWVudCksXHJcbiAgICAgIGZpbHRlcigoZTogTm9kZURyYWdnYWJsZUV2ZW50KSA9PiAhZS5jYXB0dXJlZC50cmVlLmhhc0NoaWxkKHRyZWUpKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRDb250cm9sbGVyKGlkOiBzdHJpbmcgfCBudW1iZXIsIGNvbnRyb2xsZXI6IFRyZWVDb250cm9sbGVyKTogdm9pZCB7XHJcbiAgICB0aGlzLmNvbnRyb2xsZXJzLnNldChpZCwgY29udHJvbGxlcik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGVsZXRlQ29udHJvbGxlcihpZDogc3RyaW5nIHwgbnVtYmVyKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jb250cm9sbGVycy5oYXMoaWQpKSB7XHJcbiAgICAgIHRoaXMuY29udHJvbGxlcnMuZGVsZXRlKGlkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRDb250cm9sbGVyKGlkOiBzdHJpbmcgfCBudW1iZXIpOiBUcmVlQ29udHJvbGxlciB7XHJcbiAgICBpZiAodGhpcy5jb250cm9sbGVycy5oYXMoaWQpKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNvbnRyb2xsZXJzLmdldChpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFzQ29udHJvbGxlcihpZDogc3RyaW5nIHwgbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb250cm9sbGVycy5oYXMoaWQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaG91bGRGaXJlTG9hZE5leHRMZXZlbCh0cmVlOiBUcmVlKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBzaG91bGRMb2FkTmV4dExldmVsID1cclxuICAgICAgdHJlZS5ub2RlLmVtaXRMb2FkTmV4dExldmVsICYmXHJcbiAgICAgICF0cmVlLm5vZGUubG9hZENoaWxkcmVuICYmXHJcbiAgICAgICF0cmVlLmNoaWxkcmVuQXJlQmVpbmdMb2FkZWQoKSAmJlxyXG4gICAgICBpc0VtcHR5KHRyZWUuY2hpbGRyZW4pO1xyXG5cclxuICAgIGlmIChzaG91bGRMb2FkTmV4dExldmVsKSB7XHJcbiAgICAgIHRyZWUubG9hZGluZ0NoaWxkcmVuUmVxdWVzdGVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHNob3VsZExvYWROZXh0TGV2ZWw7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZmlyZU5vZGVJbmRldGVybWluZWQodHJlZTogVHJlZSk6IHZvaWQge1xyXG4gICAgdGhpcy5ub2RlSW5kZXRlcm1pbmVkJC5uZXh0KG5ldyBOb2RlSW5kZXRlcm1pbmVkRXZlbnQodHJlZSkpO1xyXG4gIH1cclxufVxyXG4iXX0=
