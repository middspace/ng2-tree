import { NodeMenuItemAction } from './menu/menu.events';
import { MouseButtons } from './utils/event.utils';
import { get } from './utils/fn.utils';
export class TreeController {
  component;
  tree;
  treeService;
  constructor(component) {
    this.component = component;
    this.tree = this.component.tree;
    this.treeService = this.component.treeService;
  }
  select() {
    if (!this.isSelected()) {
      this.component.onNodeSelected({ button: MouseButtons.Left });
    }
  }
  unselect() {
    if (this.isSelected()) {
      this.component.onNodeUnselected({ button: MouseButtons.Left });
    }
  }
  isSelected() {
    return this.component.isSelected;
  }
  expand() {
    if (this.isCollapsed()) {
      this.component.onSwitchFoldingType();
    }
  }
  expandToParent(tree = this.tree) {
    if (tree) {
      const controller = this.treeService.getController(tree.id);
      if (controller) {
        requestAnimationFrame(() => {
          controller.expand();
          this.expandToParent(tree.parent);
        });
      }
    }
  }
  isExpanded() {
    return this.tree.isNodeExpanded();
  }
  collapse() {
    if (this.isExpanded()) {
      this.component.onSwitchFoldingType();
    }
  }
  isCollapsed() {
    return this.tree.isNodeCollapsed();
  }
  toTreeModel() {
    return this.tree.toTreeModel();
  }
  rename(newValue) {
    this.tree.markAsBeingRenamed();
    this.component.applyNewValue({ type: 'keyup', value: newValue });
  }
  remove() {
    this.component.onMenuItemSelected({ nodeMenuItemAction: NodeMenuItemAction.Remove });
  }
  addChild(newNode) {
    if (this.tree.hasDeferredChildren() && !this.tree.childrenWereLoaded()) {
      return;
    }
    const newTree = this.tree.createNode(Array.isArray(newNode.children), newNode);
    this.treeService.fireNodeCreated(newTree);
  }
  addChildAsync(newNode) {
    if (this.tree.hasDeferredChildren() && !this.tree.childrenWereLoaded()) {
      return Promise.reject(
        new Error('This node loads its children asynchronously, hence child cannot be added this way')
      );
    }
    const newTree = this.tree.createNode(Array.isArray(newNode.children), newNode);
    this.treeService.fireNodeCreated(newTree);
    // This will give TreeInternalComponent to set up a controller for the node
    return new Promise(resolve => {
      setTimeout(() => {
        resolve(newTree);
      });
    });
  }
  changeNodeId(id) {
    if (!id) {
      throw Error('You should supply an id!');
    }
    if (this.treeService.hasController(id)) {
      throw Error(`Controller already exists for the given id: ${id}`);
    }
    this.treeService.deleteController(this.tree.id);
    this.tree.id = id;
    this.treeService.setController(this.tree.id, this);
  }
  reloadChildren() {
    this.tree.reloadChildren();
  }
  setChildren(children) {
    if (!this.tree.isLeaf()) {
      this.tree.setChildren(children);
    }
  }
  startRenaming() {
    this.tree.markAsBeingRenamed();
  }
  check() {
    this.component.onNodeChecked();
  }
  uncheck() {
    this.component.onNodeUnchecked();
  }
  isChecked() {
    return this.tree.checked;
  }
  isIndetermined() {
    return get(this.component, 'checkboxElementRef.nativeElement.indeterminate');
  }
  allowSelection() {
    this.tree.selectionAllowed = true;
  }
  forbidSelection() {
    this.tree.selectionAllowed = false;
  }
  isSelectionAllowed() {
    return this.tree.selectionAllowed;
  }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3RyZWUtY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUV4RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRXZDLE1BQU0sT0FBTyxjQUFjO0lBSUw7SUFIWixJQUFJLENBQU87SUFDWCxXQUFXLENBQWM7SUFFakMsWUFBb0IsU0FBZ0M7UUFBaEMsY0FBUyxHQUFULFNBQVMsQ0FBdUI7UUFDbEQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQztRQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDO0lBQ2hELENBQUM7SUFFTSxNQUFNO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRTtZQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztTQUM5RDtJQUNILENBQUM7SUFFTSxRQUFRO1FBQ2IsSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUU7WUFDckIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLE1BQU0sRUFBRSxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztTQUNoRTtJQUNILENBQUM7SUFFTSxVQUFVO1FBQ2YsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQztJQUNuQyxDQUFDO0lBRU0sTUFBTTtRQUNYLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxTQUFTLENB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QkFBZ0IsR0FBRyxJQUFJLENBQUM7SUFDcEMsQ0FBQztJQUVNLGVBQWU7UUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7SUFDckMsQ0FBQztJQUVNLGtCQUFrQjtRQUN2QixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7SUFDcEMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHJlZVNlcnZpY2UgfSBmcm9tICcuL3RyZWUuc2VydmljZSc7XHJcbmltcG9ydCB7IFRyZWUgfSBmcm9tICcuL3RyZWUnO1xyXG5pbXBvcnQgeyBUcmVlTW9kZWwgfSBmcm9tICcuL3RyZWUudHlwZXMnO1xyXG5pbXBvcnQgeyBOb2RlTWVudUl0ZW1BY3Rpb24gfSBmcm9tICcuL21lbnUvbWVudS5ldmVudHMnO1xyXG5pbXBvcnQgeyBUcmVlSW50ZXJuYWxDb21wb25lbnQgfSBmcm9tICcuL3RyZWUtaW50ZXJuYWwuY29tcG9uZW50JztcclxuaW1wb3J0IHsgTW91c2VCdXR0b25zIH0gZnJvbSAnLi91dGlscy9ldmVudC51dGlscyc7XHJcbmltcG9ydCB7IGdldCB9IGZyb20gJy4vdXRpbHMvZm4udXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFRyZWVDb250cm9sbGVyIHtcclxuICBwcml2YXRlIHRyZWU6IFRyZWU7XHJcbiAgcHJpdmF0ZSB0cmVlU2VydmljZTogVHJlZVNlcnZpY2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29tcG9uZW50OiBUcmVlSW50ZXJuYWxDb21wb25lbnQpIHtcclxuICAgIHRoaXMudHJlZSA9IHRoaXMuY29tcG9uZW50LnRyZWU7XHJcbiAgICB0aGlzLnRyZWVTZXJ2aWNlID0gdGhpcy5jb21wb25lbnQudHJlZVNlcnZpY2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VsZWN0KCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmlzU2VsZWN0ZWQoKSkge1xyXG4gICAgICB0aGlzLmNvbXBvbmVudC5vbk5vZGVTZWxlY3RlZCh7IGJ1dHRvbjogTW91c2VCdXR0b25zLkxlZnQgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdW5zZWxlY3QoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5pc1NlbGVjdGVkKCkpIHtcclxuICAgICAgdGhpcy5jb21wb25lbnQub25Ob2RlVW5zZWxlY3RlZCh7IGJ1dHRvbjogTW91c2VCdXR0b25zLkxlZnQgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNTZWxlY3RlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudC5pc1NlbGVjdGVkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGV4cGFuZCgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzQ29sbGFwc2VkKCkpIHtcclxuICAgICAgdGhpcy5jb21wb25lbnQub25Td2l0Y2hGb2xkaW5nVHlwZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGV4cGFuZFRvUGFyZW50KHRyZWU6IGFueSA9IHRoaXMudHJlZSk6IHZvaWQge1xyXG4gICAgaWYgKHRyZWUpIHtcclxuICAgICAgY29uc3QgY29udHJvbGxlciA9IHRoaXMudHJlZVNlcnZpY2UuZ2V0Q29udHJvbGxlcih0cmVlLmlkKTtcclxuICAgICAgaWYgKGNvbnRyb2xsZXIpIHtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xyXG4gICAgICAgICAgY29udHJvbGxlci5leHBhbmQoKTtcclxuICAgICAgICAgIHRoaXMuZXhwYW5kVG9QYXJlbnQodHJlZS5wYXJlbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNFeHBhbmRlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnRyZWUuaXNOb2RlRXhwYW5kZWQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb2xsYXBzZSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzRXhwYW5kZWQoKSkge1xyXG4gICAgICB0aGlzLmNvbXBvbmVudC5vblN3aXRjaEZvbGRpbmdUeXBlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNDb2xsYXBzZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy50cmVlLmlzTm9kZUNvbGxhcHNlZCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHRvVHJlZU1vZGVsKCk6IFRyZWVNb2RlbCB7XHJcbiAgICByZXR1cm4gdGhpcy50cmVlLnRvVHJlZU1vZGVsKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVuYW1lKG5ld1ZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIHRoaXMudHJlZS5tYXJrQXNCZWluZ1JlbmFtZWQoKTtcclxuICAgIHRoaXMuY29tcG9uZW50LmFwcGx5TmV3VmFsdWUoeyB0eXBlOiAna2V5dXAnLCB2YWx1ZTogbmV3VmFsdWUgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVtb3ZlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21wb25lbnQub25NZW51SXRlbVNlbGVjdGVkKHsgbm9kZU1lbnVJdGVtQWN0aW9uOiBOb2RlTWVudUl0ZW1BY3Rpb24uUmVtb3ZlIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZENoaWxkKG5ld05vZGU6IFRyZWVNb2RlbCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMudHJlZS5oYXNEZWZlcnJlZENoaWxkcmVuKCkgJiYgIXRoaXMudHJlZS5jaGlsZHJlbldlcmVMb2FkZWQoKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmV3VHJlZSA9IHRoaXMudHJlZS5jcmVhdGVOb2RlKEFycmF5LmlzQXJyYXkobmV3Tm9kZS5jaGlsZHJlbiksIG5ld05vZGUpO1xyXG4gICAgdGhpcy50cmVlU2VydmljZS5maXJlTm9kZUNyZWF0ZWQobmV3VHJlZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYWRkQ2hpbGRBc3luYyhuZXdOb2RlOiBUcmVlTW9kZWwpOiBQcm9taXNlPFRyZWU+IHtcclxuICAgIGlmICh0aGlzLnRyZWUuaGFzRGVmZXJyZWRDaGlsZHJlbigpICYmICF0aGlzLnRyZWUuY2hpbGRyZW5XZXJlTG9hZGVkKCkpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxyXG4gICAgICAgIG5ldyBFcnJvcignVGhpcyBub2RlIGxvYWRzIGl0cyBjaGlsZHJlbiBhc3luY2hyb25vdXNseSwgaGVuY2UgY2hpbGQgY2Fubm90IGJlIGFkZGVkIHRoaXMgd2F5JylcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBuZXdUcmVlID0gdGhpcy50cmVlLmNyZWF0ZU5vZGUoQXJyYXkuaXNBcnJheShuZXdOb2RlLmNoaWxkcmVuKSwgbmV3Tm9kZSk7XHJcbiAgICB0aGlzLnRyZWVTZXJ2aWNlLmZpcmVOb2RlQ3JlYXRlZChuZXdUcmVlKTtcclxuXHJcbiAgICAvLyBUaGlzIHdpbGwgZ2l2ZSBUcmVlSW50ZXJuYWxDb21wb25lbnQgdG8gc2V0IHVwIGEgY29udHJvbGxlciBmb3IgdGhlIG5vZGVcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShuZXdUcmVlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjaGFuZ2VOb2RlSWQoaWQ6IHN0cmluZyB8IG51bWJlcikge1xyXG4gICAgaWYgKCFpZCkge1xyXG4gICAgICB0aHJvdyBFcnJvcignWW91IHNob3VsZCBzdXBwbHkgYW4gaWQhJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMudHJlZVNlcnZpY2UuaGFzQ29udHJvbGxlcihpZCkpIHtcclxuICAgICAgdGhyb3cgRXJyb3IoYENvbnRyb2xsZXIgYWxyZWFkeSBleGlzdHMgZm9yIHRoZSBnaXZlbiBpZDogJHtpZH1gKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnRyZWVTZXJ2aWNlLmRlbGV0ZUNvbnRyb2xsZXIodGhpcy50cmVlLmlkKTtcclxuICAgIHRoaXMudHJlZS5pZCA9IGlkO1xyXG4gICAgdGhpcy50cmVlU2VydmljZS5zZXRDb250cm9sbGVyKHRoaXMudHJlZS5pZCwgdGhpcyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVsb2FkQ2hpbGRyZW4oKTogdm9pZCB7XHJcbiAgICB0aGlzLnRyZWUucmVsb2FkQ2hpbGRyZW4oKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRDaGlsZHJlbihjaGlsZHJlbjogVHJlZU1vZGVsW10pOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy50cmVlLmlzTGVhZigpKSB7XHJcbiAgICAgIHRoaXMudHJlZS5zZXRDaGlsZHJlbihjaGlsZHJlbik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhcnRSZW5hbWluZygpOiB2b2lkIHtcclxuICAgIHRoaXMudHJlZS5tYXJrQXNCZWluZ1JlbmFtZWQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjaGVjaygpOiB2b2lkIHtcclxuICAgIHRoaXMuY29tcG9uZW50Lm9uTm9kZUNoZWNrZWQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1bmNoZWNrKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb21wb25lbnQub25Ob2RlVW5jaGVja2VkKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNDaGVja2VkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMudHJlZS5jaGVja2VkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzSW5kZXRlcm1pbmVkKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIGdldCh0aGlzLmNvbXBvbmVudCwgJ2NoZWNrYm94RWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmluZGV0ZXJtaW5hdGUnKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhbGxvd1NlbGVjdGlvbigpIHtcclxuICAgIHRoaXMudHJlZS5zZWxlY3Rpb25BbGxvd2VkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBmb3JiaWRTZWxlY3Rpb24oKSB7XHJcbiAgICB0aGlzLnRyZWUuc2VsZWN0aW9uQWxsb3dlZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzU2VsZWN0aW9uQWxsb3dlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLnRyZWUuc2VsZWN0aW9uQWxsb3dlZDtcclxuICB9XHJcbn1cclxuIl19
